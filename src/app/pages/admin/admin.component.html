<!-- Subscription Status Banner -->
<div class="alert alert-info mb-3" *ngIf="subscriptionStatus === 'free'">
  <strong>Free Tier:</strong> Upgrade to unlock analytics and premium features!
</div>
<div class="alert alert-success mb-3" *ngIf="subscriptionStatus === 'standard'">
  <strong>Standard Tier:</strong> Analytics enabled. Upgrade for more features!
</div>
<div class="alert alert-warning mb-3" *ngIf="subscriptionStatus === 'premium'">
  <strong>Premium Tier:</strong> All features unlocked!
</div>

<!-- Analytics Section (Feature Gated) -->
<section *ngIf="isAnalyticsEnabled; else lockedAnalytics">
  <h2 class="mb-4">School Analytics</h2>
  <div class="row">
    <div class="col-md-6 mb-4">
      <canvas
        baseChart
        [data]="performanceChartData"
        [options]="performanceChartOptions"
        chartType="line"
      >
      </canvas>
      <button
        class="btn btn-outline-primary mt-2"
        (click)="downloadChart(performanceChart, 'performance')"
      >
        Download Performance Chart
      </button>
    </div>
    <div class="col-md-6 mb-4">
      <canvas
        baseChart
        [data]="genderChartData"
        [options]="genderChartOptions"
        chartType="line"
      >
      </canvas>
      <button
        class="btn btn-outline-primary mt-2"
        (click)="downloadChart(genderChart, 'gender')"
      >
        Download Gender Chart
      </button>
    </div>
  </div>
</section>
<ng-template #lockedAnalytics>
  <div class="card p-4 text-center bg-light border">
    <h3 class="text-muted">Analytics Locked</h3>
    <p>Upgrade your subscription to access school analytics and insights.</p>
  </div>
</ng-template>
<div class="container my-4">
  <div class="row mb-4">
    <div class="col-12 text-left">
      <h1
        class="mb-3 text-danger"
        style="font-family: inherit; font-weight: 700; letter-spacing: 2px"
      >
        <span
          style="
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
          >Analytics</span
        >
      </h1>
    </div>
  </div>

  <!-- Summary Cards Section (Adobe Cloud Inspired) -->
  <div class="row text-center mb-4 g-4">
    <div class="col-md-3">
      <div
        class="card shadow-lg border-0"
        style="
          background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
          color: #fff;
        "
      >
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span><i class="bi bi-wallet2" style="font-size: 2rem"></i></span>
            <span
              class="badge bg-light text-success rounded-pill"
              style="font-size: 1.2rem"
              >UGX 743,000,000</span
            >
          </div>
          <h5 class="card-title mb-0" style="font-family: inherit">
            Requirements Revenue
          </h5>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div
        class="card shadow-lg border-0"
        style="
          background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
          color: #fff;
        "
      >
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span
              ><i class="bi bi-people-fill" style="font-size: 2rem"></i
            ></span>
            <span
              class="badge bg-light text-secondary rounded-pill"
              style="font-size: 1.2rem"
              >UGX 122,330,000</span
            >
          </div>
          <h5 class="card-title mb-0" style="font-family: inherit">
            Alumni Contributions
          </h5>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div
        class="card shadow-lg border-0"
        style="
          background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
          color: #fff;
        "
      >
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span
              ><i class="bi bi-person-check" style="font-size: 2rem"></i
            ></span>
            <span
              class="badge bg-light text-success rounded-pill"
              style="font-size: 1.2rem"
              >2,250</span
            >
          </div>
          <h5 class="card-title mb-0" style="font-family: inherit">
            Students Registered
          </h5>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div
        class="card shadow-lg border-0"
        style="
          background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
          color: #fff;
        "
      >
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span
              ><i class="bi bi-graph-up-arrow" style="font-size: 2rem"></i
            ></span>
            <span
              class="badge bg-light text-success rounded-pill"
              style="font-size: 1.2rem"
              >423</span
            >
          </div>
          <h5 class="card-title mb-0" style="font-family: inherit">
            School Fees Defaulters
          </h5>
        </div>
      </div>
    </div>
  </div>

  <!-- ðŸ“Š Charts Section -->
  <div class="row g-4">
    <!-- ðŸ« Student Performance Chart -->
    <div class="col-md-6">
      <div
        class="card shadow-lg border-0"
        style="background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%)"
      >
        <div class="card-body">
          <h5
            class="text-center mb-3"
            style="font-family: inherit; color: #330867"
          >
            Students Registered
          </h5>
          <div class="text-center mb-2">
            <button
              class="btn btn-secondary graphbtn"
              (click)="downloadChart(performanceChart, 'registration')"
            >
              Download Registration Chart <i class="bi bi-download ms-1"></i>
            </button>
          </div>
          <canvas
            baseChart
            [data]="performanceChartData"
            [options]="performanceChartOptions"
            chartType="line"
          >
          </canvas>
        </div>
      </div>
    </div>

    <!-- ðŸš¹ðŸšº Boys vs Girls Chart -->
    <div class="col-md-6">
      <div
        class="card shadow-lg border-0"
        style="background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%)"
      >
        <div class="card-body">
          <h5
            class="text-center mb-3"
            style="font-family: inherit; color: #fff"
          >
            Boys vs Girls Enrollment
          </h5>
          <div class="text-center mb-2">
            <button
              class="btn btn-light graphbtn"
              (click)="downloadChart(genderChart, 'gender')"
            >
              Download Gender Chart <i class="bi bi-download ms-1"></i>
            </button>
          </div>
          <canvas
            baseChart
            [data]="genderChartData"
            [options]="genderChartOptions"
            chartType="line"
          >
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Subscription Section -->
  <div class="row mb-4">
    <div class="col-12">
      <app-subscription></app-subscription>
    </div>
  </div>
</div>
